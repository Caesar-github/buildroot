From b5a65994760091a3c5721905a5f6662579a1df40 Mon Sep 17 00:00:00 2001
From: Jeffy Chen <jeffy.chen@rock-chips.com>
Date: Fri, 20 Nov 2020 17:13:11 +0800
Subject: [PATCH 24/42] kmssink: Support disabling vsync

Set env KMSSINK_DISABLE_VSYNC to enable it.

Signed-off-by: Jeffy Chen <jeffy.chen@rock-chips.com>
---
 sys/kms/gstkmssink.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/sys/kms/gstkmssink.c b/sys/kms/gstkmssink.c
index 24eb9f2d8..5354a9477 100644
--- a/sys/kms/gstkmssink.c
+++ b/sys/kms/gstkmssink.c
@@ -1773,6 +1773,8 @@ retry_set_plane:
   }
 
 sync_frame:
+  /* HACK: Disable vsync might cause tearing */
+  if (!g_getenv ("KMSSINK_DISABLE_VSYNC"))
   /* Wait for the previous frame to complete redraw */
   if (!gst_kms_sink_sync (self)) {
     GST_OBJECT_UNLOCK (self);
-- 
2.20.1

